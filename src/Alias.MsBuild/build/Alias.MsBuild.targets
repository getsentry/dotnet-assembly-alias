<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <AliasAssembly>$(MSBuildThisFileDirectory)..\task\Alias.MsBuild.dll</AliasAssembly>
    <AliasAssembly Condition="!Exists($(AliasAssembly))">$(MSBuildThisFileDirectory)..\bin\IncludeAliasTask\Alias.MsBuild.dll</AliasAssembly>
  </PropertyGroup>

  <UsingTask
    TaskName="Alias.AliasTask"
    AssemblyFile="$(AliasAssembly)" />
  <Target
    Name="AliasTarget"
    AfterTargets="AfterResolveReferences"
    Condition="$(DesignTimeBuild) != true Or $(BuildingForLiveUnitTesting) == true" >
    <Alias.AliasTask
      IntermediateDirectory="$(ProjectDir)$(IntermediateOutputPath)"
      ReferencePath="@(ReferencePath)"
      SignAssembly="$(SignAssembly)"
      AssemblyName="$(AssemblyName)"
      Internalize="$(Alias_Internalize)"
      AssembliesToSkipRename="@(Alias_AssembliesToSkipRename)"
      Suffix="$(Alias_Suffix)"
      Prefix="$(Alias_Prefix)"
      SolutionDir="$(SolutionDir)"
      ReferenceCopyLocalPaths="@(ReferenceCopyLocalPaths)"
      AssemblyOriginatorKeyFile="$(AssemblyOriginatorKeyFile)">

      <Output
        TaskParameter="CopyLocalPathsToAdd"
        ItemName="CopyLocalPathsToAdd" />
      <Output
        TaskParameter="CopyLocalPathsToRemove"
        ItemName="CopyLocalPathsToRemove" />
      <Output
        TaskParameter="ReferencePathToAdd"
        ItemName="ReferencePathToAdd" />
      <Output
        TaskParameter="ReferencePathToRemove"
        ItemName="ReferencePathToRemove" />

    </Alias.AliasTask>
    
    <ItemGroup>
      <ReferenceCopyLocalPaths Remove="@(CopyLocalPathsToRemove)" />
      <ReferenceCopyLocalPaths Include="@(CopyLocalPathsToAdd)" />
      <ReferencePath Remove="@(ReferencePathToRemove)" />
      <ReferencePath Include="@(ReferencePathToAdd)" />
    </ItemGroup>
    
    <!--<Message Text="ReferenceCopyLocalPaths" Importance="high" />
    <Message Text="@(ReferenceCopyLocalPaths,'%0a')" Importance="high" />
    <Message Text="ReferencePath" Importance="high" />
    <Message Text="@(ReferencePath,'%0a')" Importance="high" />-->
  </Target>

  <PropertyGroup>
    <ResolveReferencesDependsOn>$(ResolveReferencesDependsOn);AliasTarget</ResolveReferencesDependsOn>
  </PropertyGroup>
</Project>